Looking at the error, there are several issues that need to be fixed in the second version of the code:

1. **CDN/Library Loading Issues** - The errors show 401 (Unauthorized) errors when trying to load resources from CDN
2. **Babel Standalone Configuration** - The in-browser Babel compilation needs proper setup
3. **Manifest.json Missing** - The PWA manifest file is referenced but not created

Here's the fixed version of the code:

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#2563eb">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="DIYMatch">
  <meta name="description" content="AI-powered DIY assistant connecting you with verified experts and providing instant problem analysis">
  
  <title>DIYMatch - AI-Powered DIY Assistant</title>
  
  <!-- Icons for various platforms -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>🔧</text></svg>">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>🔧</text></svg>">
  
  <!-- Remove PWA Manifest for now to avoid 404 error -->
  <!-- <link rel="manifest" href="/manifest.json"> -->
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Remove Sentry for now as it's causing issues -->
  <!-- <script src="https://browser.sentry-cdn.com/7.0.0/bundle.min.js" crossorigin="anonymous"></script> -->
  
  <style>
    * {
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }
    
    input, textarea, select {
      -webkit-user-select: text;
      user-select: text;
    }
    
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
      background-color: #ffffff;
    }
    
    .safe-area-top { padding-top: env(safe-area-inset-top); }
    .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }
    
    .mobile-touch {
      cursor: pointer;
      -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
      transition: all 0.2s ease;
    }
    
    .mobile-touch:active {
      transform: scale(0.98);
      opacity: 0.8;
    }
    
    .loading-pulse { animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    
    .analysis-progress {
      background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 50%, #06b6d4 100%);
      background-size: 200% 100%;
      animation: shimmer 2s linear infinite;
    }
    
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    button { touch-action: manipulation; }
    input[type="text"], input[type="email"], input[type="password"], input[type="tel"], textarea, select { font-size: 16px !important; }
    
    .splash-screen {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: linear-gradient(135deg, #2563eb 0%, #8b5cf6 100%);
      display: flex; align-items: center; justify-content: center; z-index: 9999; color: white;
    }

    .offline-message {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #ef4444;
      color: white;
      padding: 10px;
      text-align: center;
      z-index: 10000;
      font-size: 14px;
    }

    .error-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #f9fafb;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9998;
      padding: 20px;
      text-align: center;
    }

    /* Enhanced UI Elements */
    .glass-effect {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .gradient-border {
      background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
      padding: 2px;
      border-radius: 12px;
    }

    .float-animation {
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .slide-in {
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .notification-badge {
      position: absolute;
      top: -4px;
      right: -4px;
      background: #ef4444;
      color: white;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 10px;
      font-weight: bold;
    }

    /* Star Rating */
    .star-rating {
      display: flex;
      gap: 4px;
    }

    .star {
      font-size: 20px;
      color: #d1d5db;
      cursor: pointer;
      transition: color 0.2s;
    }

    .star.filled {
      color: #fbbf24;
    }

    .star:hover {
      color: #fbbf24;
    }

    /* Progress Steps */
    .progress-steps {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2rem;
    }

    .progress-step {
      flex: 1;
      text-align: center;
      position: relative;
    }

    .progress-step:not(:last-child)::after {
      content: '';
      position: absolute;
      top: 20px;
      left: 50%;
      width: 100%;
      height: 2px;
      background: #e5e7eb;
    }

    .progress-step.completed:not(:last-child)::after {
      background: #3b82f6;
    }

    .progress-step-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #e5e7eb;
      margin: 0 auto 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      z-index: 1;
    }

    .progress-step.completed .progress-step-circle {
      background: #3b82f6;
      color: white;
    }

    .progress-step.active .progress-step-circle {
      background: #3b82f6;
      color: white;
      box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.3);
    }

    /* Voice Recording Animation */
    .recording-animation {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: #ef4444;
      position: relative;
      animation: recordPulse 1.5s ease-in-out infinite;
    }

    @keyframes recordPulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.8; }
      100% { transform: scale(1); opacity: 1; }
    }

    /* Chat Bubbles */
    .chat-bubble {
      max-width: 70%;
      padding: 12px 16px;
      border-radius: 18px;
      margin-bottom: 8px;
      word-wrap: break-word;
    }

    .chat-bubble.user {
      background: #3b82f6;
      color: white;
      align-self: flex-end;
      border-bottom-right-radius: 4px;
    }

    .chat-bubble.expert {
      background: #f3f4f6;
      color: #1f2937;
      align-self: flex-start;
      border-bottom-left-radius: 4px;
    }

    /* Emergency Button */
    .emergency-button {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      animation: emergencyPulse 2s ease-in-out infinite;
    }

    @keyframes emergencyPulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
      50% { box-shadow: 0 0 0 20px rgba(239, 68, 68, 0); }
    }

    /* Skeleton Loading */
    .skeleton {
      background: linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);
      background-size: 200% 100%;
      animation: skeleton 1.2s ease-in-out infinite;
    }

    @keyframes skeleton {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* Bottom Navigation Bar */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-around;
      padding: 0.5rem 0;
      z-index: 1000;
    }

    .bottom-nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0.5rem 1rem;
      color: #6b7280;
      font-size: 0.75rem;
      transition: color 0.2s;
    }

    .bottom-nav-item.active {
      color: #3b82f6;
    }

    .bottom-nav-item:hover {
      color: #3b82f6;
    }

    .bottom-nav-icon {
      font-size: 1.5rem;
      margin-bottom: 0.25rem;
    }

    /* File Upload Styles */
    .file-upload-zone {
      border: 2px dashed #d1d5db;
      border-radius: 12px;
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background: #f9fafb;
    }

    .file-upload-zone:hover {
      border-color: #3b82f6;
      background: #eff6ff;
    }

    .file-upload-zone.drag-over {
      border-color: #3b82f6;
      background: #dbeafe;
    }

    /* Admin Dashboard Styles */
    .admin-stat-card {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .admin-stat-value {
      font-size: 2rem;
      font-weight: bold;
      color: #1f2937;
    }

    .admin-stat-label {
      font-size: 0.875rem;
      color: #6b7280;
      margin-top: 0.25rem;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .support-chat {
        width: calc(100vw - 40px);
        right: 20px;
      }
    }
  </style>
</head>
<body>
  <div id="offline-message" class="offline-message" style="display: none;">
    No internet connection. Some features may not work.
  </div>

  <div id="error-screen" class="error-screen" style="display: none;">
    <div>
      <div style="font-size: 60px; margin-bottom: 20px;">⚠️</div>
      <h2 style="font-size: 24px; margin-bottom: 10px; color: #1f2937;">Loading Error</h2>
      <p style="color: #6b7280; margin-bottom: 20px;">Please check your internet connection and try again.</p>
      <button onclick="location.reload()" style="background: #2563eb; color: white; padding: 12px 24px; border-radius: 8px; border: none; font-size: 16px; cursor: pointer;">
        Retry
      </button>
    </div>
  </div>

  <div id="root"></div>
  
  <!-- Splash Screen -->
  <div id="splash-screen" class="splash-screen">
    <div class="text-center">
      <div class="text-6xl mb-4 animate-bounce">🔧</div>
      <h1 class="text-3xl font-bold mb-2">DIYMatch</h1>
      <p class="text-lg opacity-80">AI-Powered DIY Assistant</p>
      <div class="mt-8">
        <div class="loading-pulse inline-block w-8 h-8 border-4 border-white border-t-transparent rounded-full animate-spin"></div>
      </div>
    </div>
  </div>

  <!-- React 18 -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Remove Stripe for now -->
  <!-- <script src="https://js.stripe.com/v3/"></script> -->
  
  <script>
    'use strict';
    
    // ============================================================================
    // CONFIGURATION & INITIALIZATION
    // ============================================================================
    
    // Initialize without external dependencies for now
    const Sentry = { 
      init: () => {}, 
      captureException: (e) => console.error('Error:', e) 
    };
    const Stripe = null;
    const gtag = () => {};

    // ============================================================================
    // CONNECTIVITY & ERROR HANDLING
    // ============================================================================
    
    function checkConnectivity() {
      const offlineMessage = document.getElementById('offline-message');
      if (!navigator.onLine) {
        offlineMessage.style.display = 'block';
      } else {
        offlineMessage.style.display = 'none';
      }
    }

    window.addEventListener('online', checkConnectivity);
    window.addEventListener('offline', checkConnectivity);
    checkConnectivity();

    // Error boundary for React
    class ErrorBoundary extends React.Component {
      constructor(props) {
        super(props);
        this.state = { hasError: false };
      }

      static getDerivedStateFromError(error) {
        return { hasError: true };
      }

      componentDidCatch(error, errorInfo) {
        console.error('Error caught by boundary:', error, errorInfo);
        if (typeof Sentry !== 'undefined') {
          Sentry.captureException(error);
        }
      }

      render() {
        if (this.state.hasError) {
          return React.createElement('div', { className: 'min-h-screen flex items-center justify-center p-4' },
            React.createElement('div', { className: 'text-center' },
              React.createElement('div', { className: 'text-6xl mb-4' }, '😔'),
              React.createElement('h1', { className: 'text-2xl font-bold mb-2' }, 'Something went wrong'),
              React.createElement('p', { className: 'text-gray-600 mb-4' }, 'Please refresh the page to try again'),
              React.createElement('button', {
                onClick: () => window.location.reload(),
                className: 'bg-blue-600 text-white px-6 py-3 rounded-lg'
              }, 'Refresh Page')
            )
          );
        }

        return this.props.children;
      }
    }

    // ============================================================================
    // APP CONFIGURATION
    // ============================================================================
    
    const APP_CONFIG = {
      name: 'DIYMatch',
      version: '2.0.0',
      description: 'AI-Powered DIY Assistant with Expert Network',
      adminEmail: 'yahye21@hotmail.com',
      adminPassword: 'Graphics41_',
      supportEmail: 'support@diymatch.co.uk',
      aiAnalysisPrice: 4.99,
      sameDayMultiplier: 1.5,
      platformCommission: 0.15,
      sameDayCommission: 0.20,
      emergencyHotline: '0800-DIY-HELP',
      maxImageSize: 10 * 1024 * 1024, // 10MB
      maxVideoSize: 100 * 1024 * 1024, // 100MB
      maxFileSize: 50 * 1024 * 1024, // 50MB for documents
      freeAnalysesPerMonth: 1,
      referralBonus: 5.00,
      expertVerificationRequired: true,
      minimumExpertRating: 4.0,
      responseTimeTargets: {
        urgent: '1 hour',
        normal: '4 hours',
        scheduled: '24 hours'
      },
      supportChatEnabled: true
    };

    // ============================================================================
    // DATABASE ABSTRACTION LAYER
    // ============================================================================
    
    class DatabaseService {
      constructor() {
        this.cache = new Map();
        this.syncQueue = [];
        this.isOnline = navigator.onLine;
      }

      async query(collection, operation, data) {
        try {
          if (!this.isOnline) {
            // Queue for later sync
            this.syncQueue.push({ collection, operation, data, timestamp: Date.now() });
            return this.handleOfflineOperation(collection, operation, data);
          }

          // For demo, simulate database operations
          const result = this.handleOfflineOperation(collection, operation, data);
          this.updateCache(collection, result);
          return result;
        } catch (error) {
          console.error('Database query error:', error);
          Sentry.captureException(error);
          return this.handleOfflineOperation(collection, operation, data);
        }
      }

      handleOfflineOperation(collection, operation, data) {
        // Use local storage as fallback
        const localData = JSON.parse(localStorage.getItem(`diymatch_${collection}`) || '{}');
        
        switch (operation) {
          case 'create':
            const id = `local_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            localData[id] = { ...data, id, _local: true };
            break;
          case 'update':
            if (localData[data.id]) {
              localData[data.id] = { ...localData[data.id], ...data };
            }
            break;
          case 'delete':
            delete localData[data.id];
            break;
          case 'find':
            return Object.values(localData).filter(item => 
              Object.entries(data).every(([key, value]) => item[key] === value)
            );
        }
        
        localStorage.setItem(`diymatch_${collection}`, JSON.stringify(localData));
        return { success: true, data: localData[data.id] || localData };
      }

      async sync() {
        if (!this.isOnline || this.syncQueue.length === 0) return;
        
        const queue = [...this.syncQueue];
        this.syncQueue = [];
        
        for (const item of queue) {
          try {
            await this.query(item.collection, item.operation, item.data);
          } catch (error) {
            this.syncQueue.push(item); // Re-queue failed items
          }
        }
      }

      getAuthToken() {
        return localStorage.getItem('diymatch_auth_token') || '';
      }

      updateCache(collection, data) {
        this.cache.set(collection, data);
      }
    }

    const db = new DatabaseService();

    // Sync when coming online
    window.addEventListener('online', () => {
      db.isOnline = true;
      db.sync();
    });

    window.addEventListener('offline', () => {
      db.isOnline = false;
    });

    // ============================================================================
    // ENHANCED GLOBAL STATE
    // ============================================================================
    
    const registeredUsers = new Map();
    const expertProfiles = new Map();
    const quoteRequests = new Map();
    const bookings = new Map();
    const aiAnalysisHistory = new Map();
    const userAnalysisPurchases = new Map();
    const userFreeAnalyses = new Map();
    const userMessages = new Map();
    const messageThreads = new Map();
    const expertReviews = new Map();
    const savedProjects = new Map();
    const emergencyRequests = new Map();
    const userNotifications = new Map();
    const referralCodes = new Map();
    const expertPortfolios = new Map();
    const voiceNotes = new Map();
    const arSessions = new Map();
    const expertDocuments = new Map();
    const supportTickets = new Map();
    const systemBackups = new Map();
    
    // Parts stores database
    const partsStores = new Map([
      ['london', [
        {
          id: 'store1',
          name: 'B&Q Wembley',
          address: 'Stadium Retail Park, Wembley, HA9 0EW',
          phone: '020 8902 7200',
          distance: '2.3 miles',
          categories: ['plumbing', 'electrical', 'tools', 'paint', 'building'],
          openHours: 'Mon-Sat: 7am-8pm, Sun: 10am-4pm',
          hasParking: true,
          wheelchairAccess: true,
          inStockItems: 847
        },
        {
          id: 'store2',
          name: 'Screwfix Camden',
          address: '45 Camden High St, NW1 7JH',
          phone: '020 7387 4488',
          distance: '4.1 miles',
          categories: ['tools', 'electrical', 'plumbing', 'safety'],
          openHours: 'Mon-Fri: 6am-8pm, Sat: 7am-6pm, Sun: 9am-4pm',
          hasParking: false,
          wheelchairAccess: true,
          inStockItems: 523
        },
        {
          id: 'store3',
          name: 'Wickes Tottenham',
          address: 'Broad Lane, N15 4QD',
          phone: '020 8808 3366',
          distance: '5.2 miles',
          categories: ['building', 'plumbing', 'paint', 'tools'],
          openHours: 'Mon-Sat: 7am-7pm, Sun: 10am-4pm',
          hasParking: true,
          wheelchairAccess: true,
          inStockItems: 692
        }
      ]]
    ]);

    // Demo expert profiles with enhanced data
    const demoExperts = [
      {
        id: 'expert1',
        name: 'John Smith',
        email: 'john@example.com',
        password: 'password123',
        phone: '07123456789',
        profession: 'Master Plumber',
        postcode: 'NW1',
        location: 'Camden, London',
        bio: 'Professional plumber with 15 years experience. Specialized in emergency repairs, bathroom installations, and eco-friendly solutions. Available 24/7 for emergencies.',
        hourlyRate: 45,
        rating: 4.8,
        reviews: 127,
        completedJobs: 342,
        responseTime: '< 1 hour',
        availability: ['Mon-Fri', 'Weekends', 'Emergency 24/7'],
        certifications: 'City & Guilds Level 3 Plumbing, Water Regulations',
        insurance: 'Public Liability £2M',
        specialties: ['Emergency Repairs', 'Leak Detection', 'Bathroom Installation'],
        verified: true,
        joinedDate: '2022-03-15',
        languages: ['English', 'Polish'],
        transportMode: 'Van',
        toolsProvided: true,
        guaranteeOffered: '12 months',
        badges: ['Top Rated', 'Quick Response', 'Eco Friendly'],
        documents: ['cv_john_smith.pdf', 'cert_plumbing_level3.pdf', 'insurance_2024.pdf']
      },
      {
        id: 'expert2',
        name: 'Sarah Johnson',
        email: 'sarah@example.com',
        password: 'password123',
        phone: '07987654321',
        profession: 'Certified Electrician',
        postcode: 'E1',
        location: 'Tower Hamlets, London',
        bio: 'NICEIC approved electrician. Expert in domestic installations, testing, smart home systems, and EV charger installations. Committed to safety and innovation.',
        hourlyRate: 55,
        rating: 4.9,
        reviews: 89,
        completedJobs: 256,
        responseTime: '< 2 hours',
        availability: ['Mon-Sat', 'Emergency weekends'],
        certifications: 'NICEIC Approved, 18th Edition, EV Charging Installation',
        insurance: 'Professional Indemnity £5M',
        specialties: ['Smart Home', 'EV Chargers', 'Safety Inspections'],
        verified: true,
        joinedDate: '2021-11-08',
        languages: ['English', 'French'],
        transportMode: 'Van',
        toolsProvided: true,
        guaranteeOffered: '18 months',
        badges: ['5 Star Expert', 'Smart Home Pro', 'Safety First'],
        documents: ['cv_sarah_johnson.pdf', 'niceic_cert.pdf', 'ev_training.pdf']
      },
      {
        id: 'expert3',
        name: 'Mike Wilson',
        email: 'mike@example.com',
        password: 'password123',
        phone: '07456789123',
        profession: 'Handyman & Carpenter',
        postcode: 'SW1',
        location: 'Westminster, London',
        bio: 'Versatile handyman with carpentry expertise. No job too small! Specializing in furniture assembly, shelving, repairs, and general maintenance.',
        hourlyRate: 35,
        rating: 4.7,
        reviews: 203,
        completedJobs: 567,
        responseTime: '< 3 hours',
        availability: ['Mon-Sat'],
        certifications: 'City & Guilds Carpentry Level 2',
        insurance: 'Public Liability £1M',
        specialties: ['Furniture Assembly', 'Shelving', 'General Repairs'],
        verified: true,
        joinedDate: '2020-06-22',
        languages: ['English'],
        transportMode: 'Van',
        toolsProvided: true,
        guaranteeOffered: '6 months',
        badges: ['Popular Choice', 'Great Value'],
        documents: ['cv_mike_wilson.pdf', 'carpentry_cert.pdf']
      }
    ];

    // Initialize demo experts with documents
    demoExperts.forEach(expert => {
      expertProfiles.set(expert.id, expert);
      // Also add to registeredUsers for login
      registeredUsers.set(expert.email.toLowerCase(), {
        ...expert,
        type: 'expert',
        password: expert.password
      });
      
      expertDocuments.set(expert.id, {
        cv: null,
        certifications: [],
        insurance: null,
        uploadedAt: new Date().toISOString()
      });
      expertReviews.set(expert.id, [
        {
          id: `review_${expert.id}_1`,
          userName: 'Alice M.',
          rating: 5,
          date: '2024-01-15',
          comment: 'Excellent work! Very professional and efficient.',
          jobType: 'Emergency Repair'
        },
        {
          id: `review_${expert.id}_2`,
          userName: 'David K.',
          rating: 4,
          date: '2024-01-20',
          comment: 'Good service, arrived on time and fixed the issue quickly.',
          jobType: 'Installation'
        }
      ]);
      expertPortfolios.set(expert.id, [
        {
          id: `portfolio_${expert.id}_1`,
          title: 'Bathroom Renovation',
          description: 'Complete bathroom makeover with modern fixtures',
          images: ['https://via.placeholder.com/300x200?text=Before', 'https://via.placeholder.com/300x200?text=After'],
          date: '2023-12-01'
        }
      ]);
    });

    // Add demo user
    registeredUsers.set('demo@example.com', {
      id: 'user_demo',
      name: 'Demo User',
      email: 'demo@example.com',
      password: 'demo123',
      type: 'user',
      analysisCount: 2,
      totalSpent: 0,
      referralCode: 'DIYDEMO2024',
      postcode: 'SW1A 1AA',
      phone: '07700900123',
      joinedDate: '2024-01-01',
      savedExperts: ['expert1', 'expert2'],
      settings: {
        notifications: true,
        newsletter: false,
        theme: 'light'
      }
    });

    // ============================================================================
    // PAYMENT SERVICE
    // ============================================================================
    
    class PaymentService {
      constructor() {
        this.stripe = Stripe;
      }

      async createPaymentIntent(amount, metadata) {
        try {
          // In production, this would call your backend
          // For demo, simulate success
          return 'demo_payment_intent_' + Date.now();
        } catch (error) {
          console.error('Payment error:', error);
          return 'demo_payment_intent_' + Date.now();
        }
      }

      async processPayment(amount, metadata, paymentMethod = 'card') {
        try {
          // Demo mode
          console.log('Demo payment:', { amount, metadata, paymentMethod });
          return {
            success: true,
            paymentId: `demo_pay_${Date.now()}`,
            amount,
            metadata
          };
        } catch (error) {
          console.error('Payment processing error:', error);
          Sentry.captureException(error);
          throw error;
        }
      }

      async refund(paymentId, amount, reason) {
        try {
          // Demo refund
          return {
            success: true,
            refundId: `demo_refund_${Date.now()}`,
            amount,
            reason
          };
        } catch (error) {
          console.error('Refund error:', error);
          throw error;
        }
      }
    }

    const paymentService = new PaymentService();

    // ============================================================================
    // AI ANALYSIS SERVICE
    // ============================================================================
    
    class AIAnalysisService {
      constructor() {
        this.endpoint = APP_CONFIG.aiAnalysisEndpoint;
        this.apiKey = 'YOUR_OPENAI_API_KEY';
      }

      async analyzeImage(imageData, description) {
        try {
          // For demo, use fallback analysis
          return this.fallbackAnalysis(description);
        } catch (error) {
          console.error('AI analysis error:', error);
          return this.fallbackAnalysis(description);
        }
      }

      fallbackAnalysis(description) {
        // Existing pattern-based analysis as fallback
        return analyzeWithAI(description.toLowerCase(), { type: 'image', data: '' });
      }
    }

    const aiService = new AIAnalysisService();

    // ============================================================================
    // EMAIL SERVICE
    // ============================================================================
    
    class EmailService {
      constructor() {
        this.templates = {
          welcome: (user) => ({
            subject: 'Welcome to DIYMatch! 🔧',
            html: `
              <h2>Welcome ${user.name}!</h2>
              <p>Thank you for joining DIYMatch, your AI-powered DIY assistant.</p>
            `,
            text: `Welcome ${user.name}! Thank you for joining DIYMatch.`
          }),
          
          bookingConfirmation: (booking, user, expert) => ({
            subject: `Booking Confirmed - ${expert.name} on ${new Date(booking.date).toLocaleDateString()}`,
            html: `
              <h2>Booking Confirmation</h2>
              <p>Your booking with ${expert.name} is confirmed.</p>
            `,
            text: `Booking confirmed with ${expert.name}`
          })
        };
      }

      async send(to, template, data) {
        try {
          // For demo, just log
          const emailContent = typeof template === 'string' 
            ? this.templates[template](data)
            : template;
          
          console.log('Email sent:', { to, ...emailContent });
          return { success: true };
        } catch (error) {
          console.error('Email service error:', error);
          return { success: false, error: error.message };
        }
      }
    }

    const emailService = new EmailService();

    // ============================================================================
    // BACKUP SERVICE
    // ============================================================================
    
    class BackupService {
      constructor() {
        this.schedule = APP_CONFIG.backupSchedule;
        this.lastBackup = null;
      }

      async createBackup() {
        try {
          const timestamp = new Date().toISOString();
          const data = {
            timestamp,
            users: Array.from(registeredUsers.entries()),
            experts: Array.from(expertProfiles.entries()),
            bookings: Array.from(bookings.entries()),
            analyses: Array.from(aiAnalysisHistory.entries()),
            reviews: Array.from(expertReviews.entries())
          };

          const backup = {
            id: `backup_${timestamp}`,
            timestamp,
            size: JSON.stringify(data).length,
            status: 'completed',
            location: 'local'
          };

          systemBackups.set(backup.id, backup);
          this.lastBackup = timestamp;

          return backup;
        } catch (error) {
          console.error('Backup failed:', error);
          Sentry.captureException(error);
          throw error;
        }
      }

      scheduleAutoBackup() {
        // Simple daily backup check
        setInterval(() => {
          const now = new Date();
          if (now.getHours() === 2 && now.getMinutes() === 0) {
            this.createBackup();
          }
        }, 60000);
      }
    }

    const backupService = new BackupService();
    backupService.scheduleAutoBackup();

    // ============================================================================
    // ANALYTICS SERVICE
    // ============================================================================
    
    class AnalyticsService {
      constructor() {
        this.enabled = typeof gtag !== 'undefined';
      }

      track(eventName, parameters = {}) {
        console.log('Analytics event:', eventName, parameters);
      }

      trackPageView(pageName) {
        this.track('page_view', { page_name: pageName });
      }

      trackUserAction(action, category, label, value) {
        this.track(action, {
          event_category: category,
          event_label: label,
          value: value
        });
      }

      trackError(error, fatal = false) {
        this.track('exception', {
          description: error.message || error,
          fatal: fatal
        });
      }

      trackConversion(type, value) {
        this.track('conversion', {
          conversion_type: type,
          value: value,
          currency: 'GBP'
        });
      }
    }

    const analytics = new AnalyticsService();

    // ============================================================================
    // CUSTOMER SUPPORT SERVICE
    // ============================================================================
    
    class CustomerSupportService {
      constructor() {
        this.enabled = APP_CONFIG.supportChatEnabled;
      }

      async createTicket(userId, subject, message, priority = 'normal') {
        try {
          const ticket = {
            id: `ticket_${Date.now()}`,
            userId,
            subject,
            message,
            priority,
            status: 'open',
            createdAt: new Date().toISOString(),
            responses: []
          };

          supportTickets.set(ticket.id, ticket);
          
          // Notify support team
          await emailService.send(APP_CONFIG.supportEmail, {
            subject: `New Support Ticket: ${subject}`,
            html: `<p>Priority: ${priority}</p><p>Message: ${message}</p>`,
            text: `Priority: ${priority}\nMessage: ${message}`
          });

          return ticket;
        } catch (error) {
          console.error('Support ticket creation failed:', error);
          throw error;
        }
      }

      async respondToTicket(ticketId, message, isStaff = false) {
        const ticket = supportTickets.get(ticketId);
        if (!ticket) throw new Error('Ticket not found');

        const response = {
          id: `response_${Date.now()}`,
          message,
          isStaff,
          timestamp: new Date().toISOString()
        };

        ticket.responses.push(response);
        ticket.lastUpdated = response.timestamp;

        return ticket;
      }

      getTicketsForUser(userId) {
        return Array.from(supportTickets.values())
          .filter(ticket => ticket.userId === userId)
          .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
      }

      getAllTickets() {
        return Array.from(supportTickets.values())
          .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
      }
    }

    const supportService = new CustomerSupportService();

    // ============================================================================
    // ENHANCED UTILITY FUNCTIONS
    // ============================================================================
    
    const triggerHaptic = (type = 'light') => {
      if (navigator.vibrate) {
        const patterns = {
          light: 50,
          medium: 100,
          heavy: 200,
          success: [50, 100, 50],
          error: [100, 50, 100],
          warning: [200, 100, 200]
        };
        navigator.vibrate(patterns[type] || 50);
      }
    };

    const takePhoto = () => {
      return new Promise((resolve) => {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        input.capture = 'environment';
        input.onchange = (e) => {
          const file = e.target.files[0];
          if (file) {
            if (file.size > APP_CONFIG.maxImageSize) {
              alert(`Image must be less than ${APP_CONFIG.maxImageSize / 1024 / 1024}MB`);
              return;
            }
            const reader = new FileReader();
            reader.onload = (event) => resolve({ type: 'image', data: event.target.result, file });
            reader.readAsDataURL(file);
          }
        };
        input.click();
      });
    };

    const takeVideo = () => {
      return new Promise((resolve) => {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'video/*';
        input.capture = 'environment';
        input.onchange = (e) => {
          const file = e.target.files[0];
          if (file && file.size <= APP_CONFIG.maxVideoSize) {
            const reader = new FileReader();
            reader.onload = (event) => resolve({ type: 'video', data: event.target.result, file });
            reader.readAsDataURL(file);
          } else if (file) {
            alert(`Video must be less than ${APP_CONFIG.maxVideoSize / 1024 / 1024}MB`);
          }
        };
        input.click();
      });
    };

    const recordVoiceNote = () => {
      return new Promise((resolve) => {
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
          alert('Voice recording not supported on this device');
          resolve(null);
          return;
        }

        // Simulated voice recording for demo
        const duration = prompt('Record voice note (enter duration in seconds):');
        if (duration) {
          resolve({
            type: 'voice',
            duration: parseInt(duration),
            data: 'data:audio/webm;base64,simulatedVoiceData',
            timestamp: new Date().toISOString()
          });
        } else {
          resolve(null);
        }
      });
    };

    // Free analysis management
    const checkFreeAnalysisAvailable = (userEmail) => {
      const currentMonth = new Date().toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
      const userRecord = userFreeAnalyses.get(userEmail);
      
      if (!userRecord || userRecord.month !== currentMonth) {
        return true;
      }
      
      return userRecord.used < APP_CONFIG.freeAnalysesPerMonth;
    };

    const useFreeAnalysis = (userEmail) => {
      const currentMonth = new Date().toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
      const userRecord = userFreeAnalyses.get(userEmail) || { month: currentMonth, used: 0 };
      
      if (userRecord.month !== currentMonth) {
        userRecord.month = currentMonth;
        userRecord.used = 0;
      }
      
      userRecord.used++;
      userRecord.lastUsed = new Date().toISOString();
      userFreeAnalyses.set(userEmail, userRecord);
      
      analytics.track('free_analysis_used', { userEmail, month: currentMonth });
    };

    // Generate referral code
    const generateReferralCode = (userId) => {
      const code = `DIY${userId.substring(5, 9).toUpperCase()}${Math.random().toString(36).substr(2, 4).toUpperCase()}`;
      referralCodes.set(code, {
        userId,
        uses: 0,
        earnings: 0,
        created: new Date().toISOString()
      });
      return code;
    };

    // ============================================================================
    // AI ANALYSIS ENGINE
    // ============================================================================
    
    const analyzeWithAI = (keywords, media) => {
      let problemType = 'General Maintenance';
      let severity = 'Medium';
      let confidence = 85;
      let isDIYFriendly = true;
      let estimatedCost = '£50-£150';
      let recommendedExpert = 'Handyman';
      let timeToFix = '1-2 hours';
      
      const problemPatterns = {
        electrical: {
          keywords: ['electric', 'socket', 'wire', 'switch', 'fuse', 'circuit', 'power', 'outlet', 'spark', 'breaker', 'voltage'],
          problem: 'Electrical Issue',
          severity: 'Critical',
          diy: false,
          expert: 'Electrician',
          cost: '£100-£300',
          time: '2-4 hours'
        },
        plumbing: {
          keywords: ['leak', 'water', 'pipe', 'tap', 'drain', 'toilet', 'shower', 'sink', 'drip', 'flood', 'pressure'],
          problem: 'Plumbing Issue',
          severity: 'High',
          diy: true,
          expert: 'Plumber',
          cost: '£80-£200',
          time: '1-3 hours'
        },
        structural: {
          keywords: ['wall', 'crack', 'ceiling', 'floor', 'foundation', 'damp', 'mold', 'mould', 'subsidence', 'roof'],
          problem: 'Structural/Damp Issue',
          severity: 'High',
          diy: false,
          expert: 'Building Surveyor',
          cost: '£150-£500',
          time: '4-8 hours'
        },
        heating: {
          keywords: ['boiler', 'radiator', 'heating', 'cold', 'thermostat', 'gas', 'central heating', 'hot water'],
          problem: 'Heating/Gas Issue',
          severity: 'Critical',
          diy: false,
          expert: 'Gas Safe Engineer',
          cost: '£150-£400',
          time: '2-5 hours'
        }
      };

      // Find best matching pattern
      for (const [type, config] of Object.entries(problemPatterns)) {
        if (config.keywords.some(keyword => keywords.includes(keyword))) {
          problemType = config.problem;
          severity = config.severity;
          isDIYFriendly = config.diy;
          recommendedExpert = config.expert;
          estimatedCost = config.cost;
          timeToFix = config.time;
          confidence = 90;
          break;
        }
      }

      const safetyWarnings = severity === 'Critical' 
        ? ['Turn off power/water supply', 'Do not attempt DIY repair', 'Call professional immediately']
        : severity === 'High'
        ? ['Wear safety equipment', 'Turn off relevant utilities', 'Work with caution']
        : ['Use appropriate tools', 'Follow safety guidelines'];

      const recommendedParts = problemType.includes('Plumbing')
        ? [
            { name: 'Pipe Repair Kit', price: '£12.99', priority: 'Essential' },
            { name: 'PTFE Tape', price: '£2.49', priority: 'Essential' },
            { name: 'Adjustable Wrench', price: '£15.99', priority: 'Recommended' }
          ]
        : problemType.includes('Electrical')
        ? [
            { name: 'Voltage Tester', price: '£19.99', priority: 'Essential' },
            { name: 'Insulated Tools', price: '£34.99', priority: 'Essential' }
          ]
        : [
            { name: 'Basic Tool Kit', price: '£24.99', priority: 'Recommended' }
          ];

      return {
        problemDetected: problemType,
        confidence: confidence + '%',
        severity,
        description: `AI analysis indicates this is a ${problemType.toLowerCase()}. ${
          severity === 'Critical' ? 'Professional assistance strongly recommended.' : 
          severity === 'High' ? 'Prompt attention advised.' : 
          'Can be addressed at your convenience.'
        }`,
        isDIYFriendly,
        estimatedCost,
        timeToFix,
        recommendedExpertType: recommendedExpert,
        safetyWarnings,
        recommendedParts,
        mediaType: media?.type || 'text',
        timestamp: new Date().toISOString()
      };
    };

    const performAIAnalysis = async (media, description, progressCallback) => {
      const analysisSteps = [
        { progress: 10, delay: 300, message: 'Initializing AI engine...' },
        { progress: 20, delay: 400, message: 'Processing ' + media.type + '...' },
        { progress: 35, delay: 500, message: 'Analyzing problem patterns...' },
        { progress: 50, delay: 400, message: 'Checking safety database...' },
        { progress: 65, delay: 500, message: 'Identifying required tools...' },
        { progress: 80, delay: 400, message: 'Finding compatible parts...' },
        { progress: 95, delay: 300, message: 'Generating recommendations...' },
        { progress: 100, delay: 200, message: 'Finalizing report...' }
      ];

      // Simulate progress
      for (const step of analysisSteps) {
        await new Promise(resolve => setTimeout(resolve, step.delay));
        progressCallback(step.progress, step.message);
      }

      return analyzeWithAI(description.toLowerCase(), media);
    };

    // ============================================================================
    // DATABASE OPERATIONS
    // ============================================================================
    
    const dbOperations = {
      async createUser(userData) {
        try {
          const user = {
            id: `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
            ...userData,
            createdAt: new Date().toISOString(),
            analysisCount: 0,
            totalSpent: 0,
            referralCode: generateReferralCode(`user_${Date.now()}`),
            settings: {
              notifications: true,
              newsletter: false,
              theme: 'light'
            }
          };
          
          registeredUsers.set(userData.email.toLowerCase(), user);
          await db.query('users', 'create', user);
          
          analytics.track('user_created', { userType: userData.userType });
          return { success: true, user };
        } catch (error) {
          console.error('Create user error:', error);
          throw error;
        }
      },

      async createExpert(expertData) {
        try {
          const expert = {
            id: `expert_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
            ...expertData,
            createdAt: new Date().toISOString(),
            verified: false,
            rating: 0,
            reviews: 0,
            completedJobs: 0,
            badges: [],
            accountStatus: 'pending_verification'
          };
          
          expertProfiles.set(expert.id, expert);
          registeredUsers.set(expert.email.toLowerCase(), {
            ...expert,
            type: 'expert'
          });
          await db.query('experts', 'create', expert);
          
          analytics.track('expert_created', { profession: expertData.profession });
          return { success: true, expert };
        } catch (error) {
          console.error('Create expert error:', error);
          throw error;
        }
      },

      async saveAnalysis(analysisData) {
        try {
          const analysis = {
            id: `analysis_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
            ...analysisData,
            timestamp: new Date().toISOString()
          };
          
          if (!aiAnalysisHistory.has(analysisData.userEmail)) {
            aiAnalysisHistory.set(analysisData.userEmail, []);
          }
          aiAnalysisHistory.get(analysisData.userEmail).push(analysis);
          
          await db.query('analyses', 'create', analysis);
          
          // Update user's analysis count
          const user = registeredUsers.get(analysisData.userEmail);
          if (user) {
            user.analysisCount++;
          }
          
          analytics.track('analysis_completed', { 
            problemType: analysisData.problemDetected, 
            severity: analysisData.severity 
          });
          
          return { success: true, analysis };
        } catch (error) {
          console.error('Save analysis error:', error);
          throw error;
        }
      },

      async createEmergencyRequest(requestData) {
        try {
          const emergency = {
            id: `emergency_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
            ...requestData,
            timestamp: new Date().toISOString(),
            status: 'active',
            respondedExperts: []
          };
          
          emergencyRequests.set(emergency.id, emergency);
          await db.query('emergencies', 'create', emergency);
          
          // Alert available experts
          const availableExperts = Array.from(expertProfiles.values()).filter(expert => {
            const matchesCategory = expert.specialties.some(s => 
              s.toLowerCase().includes(requestData.category.toLowerCase())
            );
            const isAvailable = expert.availability.includes('Emergency 24/7');
            const isVerified = expert.verified;
            return matchesCategory && isAvailable && isVerified;
          });
          
          analytics.track('emergency_created', { 
            category: requestData.category, 
            notifiedExperts: availableExperts.length 
          });
          
          return { success: true, emergency, notifiedExperts: availableExperts.length };
        } catch (error) {
          console.error('Create emergency error:', error);
          throw error;
        }
      }
    };

    // ============================================================================
    // REACT COMPONENTS
    // ============================================================================
    
    const { useState, useEffect, useContext, createContext } = React;

    // Contexts
    const AuthContext = createContext();
    const NotificationContext = createContext();

    // Custom Hooks
    const useNotifications = () => {
      const [notifications, setNotifications] = useState([]);
      
      const addNotification = (notification) => {
        const newNotif = {
          id: Date.now(),
          ...notification,
          timestamp: new Date().toISOString()
        };
        setNotifications(prev => [newNotif, ...prev]);
        
        if (!notification.persistent) {
          setTimeout(() => {
            removeNotification(newNotif.id);
          }, 5000);
        }
      };
      
      const removeNotification = (id) => {
        setNotifications(prev => prev.filter(n => n.id !== id));
      };
      
      return {
        notifications,
        addNotification,
        removeNotification
      };
    };

    // Shared Components
    const LoadingSpinner = ({ size = 'medium', color = 'blue' }) => {
      const sizeClasses = {
        small: 'w-4 h-4',
        medium: 'w-8 h-8',
        large: 'w-12 h-12'
      };
      
      return React.createElement('div', {
        className: `${sizeClasses[size]} border-4 border-${color}-600 border-t-transparent rounded-full animate-spin`
      });
    };

    const EmptyState = ({ icon, title, description, action }) => {
      return React.createElement('div', { className: 'text-center py-12' },
        React.createElement('div', { className: 'text-6xl mb-4' }, icon),
        React.createElement('h3', { className: 'text-xl font-semibold mb-2' }, title),
        React.createElement('p', { className: 'text-gray-600 mb-4' }, description),
        action
      );
    };

    const ProgressSteps = ({ steps, currentStep }) => {
      return React.createElement('div', { className: 'progress-steps mb-6' },
        steps.map((step, index) =>
          React.createElement('div', {
            key: index,
            className: `progress-step ${
              index < currentStep ? 'completed' : 
              index === currentStep ? 'active' : ''
            }`
          },
            React.createElement('div', { className: 'progress-step-circle' },
              index < currentStep ? '✓' : index + 1
            ),
            React.createElement('div', { className: 'text-xs mt-1' }, step)
          )
        )
      );
    };

    const StarRating = ({ rating, onRate, readonly = false }) => {
      const [hover, setHover] = useState(0);
      
      return React.createElement('div', { className: 'star-rating' },
        [1, 2, 3, 4, 5].map((star) =>
          React.createElement('span', {
            key: star,
            className: `star ${star <= (hover || rating) ? 'filled' : ''}`,
            onClick: () => !readonly && onRate && onRate(star),
            onMouseEnter: () => !readonly && setHover(star),
            onMouseLeave: () => !readonly && setHover(0),
            style: { cursor: readonly ? 'default' : 'pointer' }
          }, '★')
        )
      );
    };

    const Modal = ({ isOpen, onClose, title, children }) => {
      if (!isOpen) return null;
      
      return React.createElement('div', {
        className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4'
      },
        React.createElement('div', { className: 'bg-white rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto' },
          React.createElement('div', { className: 'flex justify-between items-center p-4 border-b' },
            React.createElement('h2', { className: 'text-xl font-semibold' }, title),
            React.createElement('button', {
              onClick: onClose,
              className: 'text-gray-500 hover:text-gray-700 text-2xl'
            }, '×')
          ),
          React.createElement('div', { className: 'p-4' }, children)
        )
      );
    };

    // Welcome Page
    const WelcomePage = ({ onGetStarted, onLoginExpert }) => {
      analytics.trackPageView('welcome');
      
      return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-blue-50 to-purple-50' },
        React.createElement('div', { className: 'safe-area-top' },
          React.createElement('div', { className: 'container mx-auto px-4 py-8' },
            React.createElement('div', { className: 'text-center mb-12' },
              React.createElement('div', { className: 'text-6xl mb-4 float-animation' }, '🔧'),
              React.createElement('h1', { className: 'text-5xl font-bold mb-4' }, 'DIYMatch'),
              React.createElement('p', { className: 'text-xl text-gray-600' }, 'AI-Powered DIY Assistant & Expert Network')
            ),
            React.createElement('div', { className: 'bg-white rounded-2xl shadow-xl p-8 max-w-4xl mx-auto mb-8' },
              React.createElement('h2', { className: 'text-3xl font-bold text-center mb-8' }, 'Fix It Right, Every Time'),
              React.createElement('div', { className: 'grid md:grid-cols-3 gap-8 mb-8' },
                React.createElement('div', { className: 'text-center' },
                  React.createElement('div', { className: 'text-5xl mb-4' }, '📸'),
                  React.createElement('h3', { className: 'text-xl font-semibold mb-2' }, 'AI Analysis'),
                  React.createElement('p', { className: 'text-gray-600' }, 'Snap a photo and get instant expert analysis')
                ),
                React.createElement('div', { className: 'text-center' },
                  React.createElement('div', { className: 'text-5xl mb-4' }, '👨‍🔧'),
                  React.createElement('h3', { className: 'text-xl font-semibold mb-2' }, 'Expert Network'),
                  React.createElement('p', { className: 'text-gray-600' }, 'Connect with verified local professionals')
                ),
                React.createElement('div', { className: 'text-center' },
                  React.createElement('div', { className: 'text-5xl mb-4' }, '🛠️'),
                  React.createElement('h3', { className: 'text-xl font-semibold mb-2' }, 'DIY Guidance'),
                  React.createElement('p', { className: 'text-gray-600' }, 'Step-by-step instructions and safety tips')
                )
              ),
              React.createElement('div', { className: 'flex flex-col sm:flex-row gap-4 justify-center' },
                React.createElement('button', {
                  onClick: onGetStarted,
                  className: 'mobile-touch bg-blue-600 text-white px-8 py-4 rounded-full text-lg font-semibold hover:bg-blue-700 transition-all transform hover:scale-105'
                }, '🚀 Get Started'),
                React.createElement('button', {
                  onClick: onLoginExpert,
                  className: 'mobile-touch bg-green-600 text-white px-8 py-4 rounded-full text-lg font-semibold hover:bg-green-700 transition-all transform hover:scale-105'
                }, '👨‍🔧 Expert Login')
              )
            ),
            React.createElement('div', { className: 'bg-yellow-50 rounded-2xl p-6 max-w-4xl mx-auto' },
              React.createElement('h3', { className: 'text-xl font-semibold mb-4 flex items-center justify-center' },
                React.createElement('span', { className: 'text-2xl mr-2' }, '🆓'),
                'First AI Analysis FREE Every Month!'
              ),
            React.createElement('p', { className: 'text-center text-gray-700' },
               `New users get their first problem analysis completely free. Additional analyses only £${APP_CONFIG.aiAnalysisPrice}.`
             )
           )
         )
       )
     );
   };

   // User Dashboard
   const UserDashboard = ({ user, onLogout }) => {
     const [activeTab, setActiveTab] = useState('home');
     const [analysisHistory, setAnalysisHistory] = useState([]);
     const [notifications, setNotifications] = useState([]);
     
     useEffect(() => {
       const userAnalyses = aiAnalysisHistory.get(user.email) || [];
       setAnalysisHistory(userAnalyses);
       
       const userNotifs = userNotifications.get(user.email) || [];
       setNotifications(userNotifs);
       
       analytics.trackPageView('user_dashboard');
     }, [user]);
     
     const handleNewAnalysis = async () => {
       const freeAvailable = checkFreeAnalysisAvailable(user.email);
       
       if (!freeAvailable && !confirm(`This will cost £${APP_CONFIG.aiAnalysisPrice}. Continue?`)) {
         return;
       }
       
       setActiveTab('analyze');
     };
     
     const renderHomeTab = () => React.createElement('div', { className: 'space-y-6' },
       React.createElement('div', { className: 'bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl p-6 text-white' },
         React.createElement('h2', { className: 'text-2xl font-bold mb-2' }, `Welcome back, ${user.name}!`),
         React.createElement('p', { className: 'mb-4' }, 
           'Your referral code: ',
           React.createElement('span', { className: 'font-mono bg-white/20 px-2 py-1 rounded' }, user.referralCode)
         ),
         React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
           React.createElement('div', null,
             React.createElement('div', { className: 'text-3xl font-bold' }, user.analysisCount || 0),
             React.createElement('div', { className: 'text-sm opacity-80' }, 'Analyses Done')
           ),
           React.createElement('div', null,
             React.createElement('div', { className: 'text-3xl font-bold' }, `£${user.totalSpent || 0}`),
             React.createElement('div', { className: 'text-sm opacity-80' }, 'Total Saved')
           )
         )
       ),
       
       React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
         React.createElement('button', {
           onClick: handleNewAnalysis,
           className: 'mobile-touch bg-blue-600 text-white p-6 rounded-xl hover:bg-blue-700 transition-all'
         },
           React.createElement('div', { className: 'text-3xl mb-2' }, '📸'),
           React.createElement('div', { className: 'font-semibold' }, 'New Analysis'),
           React.createElement('div', { className: 'text-sm opacity-80' },
             checkFreeAnalysisAvailable(user.email) ? 'FREE this month!' : `£${APP_CONFIG.aiAnalysisPrice}`
           )
         ),
         
         React.createElement('button', {
           onClick: () => setActiveTab('experts'),
           className: 'mobile-touch bg-green-600 text-white p-6 rounded-xl hover:bg-green-700 transition-all'
         },
           React.createElement('div', { className: 'text-3xl mb-2' }, '👨‍🔧'),
           React.createElement('div', { className: 'font-semibold' }, 'Find Experts'),
           React.createElement('div', { className: 'text-sm opacity-80' }, 'Verified professionals')
         ),
         
         React.createElement('button', {
           onClick: () => setActiveTab('emergency'),
           className: 'mobile-touch emergency-button text-white p-6 rounded-xl hover:opacity-90 transition-all'
         },
           React.createElement('div', { className: 'text-3xl mb-2' }, '🚨'),
           React.createElement('div', { className: 'font-semibold' }, 'Emergency Help'),
           React.createElement('div', { className: 'text-sm opacity-80' }, '24/7 urgent assistance')
         ),
         
         React.createElement('button', {
           onClick: () => setActiveTab('parts'),
           className: 'mobile-touch bg-purple-600 text-white p-6 rounded-xl hover:bg-purple-700 transition-all'
         },
           React.createElement('div', { className: 'text-3xl mb-2' }, '🛠️'),
           React.createElement('div', { className: 'font-semibold' }, 'Find Parts'),
           React.createElement('div', { className: 'text-sm opacity-80' }, 'Nearby stores')
         )
       ),
       
       analysisHistory.length > 0 && React.createElement('div', { className: 'bg-white rounded-xl shadow-lg p-6' },
         React.createElement('h3', { className: 'text-xl font-semibold mb-4' }, 'Recent Analyses'),
         React.createElement('div', { className: 'space-y-3' },
           analysisHistory.slice(0, 3).map((analysis, index) =>
             React.createElement('div', {
               key: index,
               className: 'flex items-center justify-between p-3 bg-gray-50 rounded-lg'
             },
               React.createElement('div', null,
                 React.createElement('div', { className: 'font-medium' }, analysis.problemDetected),
                 React.createElement('div', { className: 'text-sm text-gray-600' },
                   new Date(analysis.timestamp).toLocaleDateString()
                 )
               ),
               React.createElement('div', {
                 className: `px-3 py-1 rounded-full text-sm ${
                   analysis.severity === 'Critical' ? 'bg-red-100 text-red-800' :
                   analysis.severity === 'High' ? 'bg-orange-100 text-orange-800' :
                   'bg-yellow-100 text-yellow-800'
                 }`
               }, analysis.severity)
             )
           )
         )
       )
     );
     
     const renderAnalyzeTab = () => React.createElement(AIAnalysisPage, { user });
     
     const renderExpertsTab = () => React.createElement(ExpertSearchPage, { user });
     
     const renderEmergencyTab = () => React.createElement(EmergencyHelpPage, { user });
     
     const renderPartsTab = () => React.createElement(PartsFinderPage, { user });
     
     const renderHistoryTab = () => React.createElement('div', { className: 'space-y-4' },
       React.createElement('h2', { className: 'text-2xl font-bold mb-4' }, 'Analysis History'),
       analysisHistory.length === 0 
         ? React.createElement(EmptyState, {
             icon: '📋',
             title: 'No analyses yet',
             description: 'Start by taking a photo of your DIY problem',
             action: React.createElement('button', {
               onClick: () => setActiveTab('analyze'),
               className: 'bg-blue-600 text-white px-6 py-2 rounded-lg'
             }, 'Start Analysis')
           })
         : analysisHistory.map((analysis, index) =>
             React.createElement('div', {
               key: index,
               className: 'bg-white rounded-lg shadow-md p-6'
             },
               React.createElement('div', { className: 'flex justify-between items-start mb-4' },
                 React.createElement('div', null,
                   React.createElement('h3', { className: 'text-lg font-semibold' }, analysis.problemDetected),
                   React.createElement('p', { className: 'text-gray-600' },
                     new Date(analysis.timestamp).toLocaleString()
                   )
                 ),
                 React.createElement('div', {
                   className: `px-3 py-1 rounded-full text-sm ${
                     analysis.severity === 'Critical' ? 'bg-red-100 text-red-800' :
                     analysis.severity === 'High' ? 'bg-orange-100 text-orange-800' :
                     'bg-yellow-100 text-yellow-800'
                   }`
                 }, analysis.severity)
               ),
               React.createElement('p', { className: 'text-gray-700 mb-3' }, analysis.description),
               React.createElement('div', { className: 'grid grid-cols-2 gap-4 text-sm' },
                 React.createElement('div', null,
                   React.createElement('span', { className: 'font-medium' }, 'Estimated Cost: '),
                   analysis.estimatedCost
                 ),
                 React.createElement('div', null,
                   React.createElement('span', { className: 'font-medium' }, 'DIY Friendly: '),
                   analysis.isDIYFriendly ? 'Yes' : 'No'
                 )
               )
             )
           )
     );
     
     const renderProfileTab = () => React.createElement(UserProfilePage, { user });
     
     return React.createElement('div', { className: 'min-h-screen bg-gray-50' },
       React.createElement('div', { className: 'safe-area-top bg-white shadow-sm' },
         React.createElement('div', { className: 'container mx-auto px-4 py-4' },
           React.createElement('div', { className: 'flex justify-between items-center' },
             React.createElement('h1', { className: 'text-2xl font-bold flex items-center' },
               React.createElement('span', { className: 'text-3xl mr-2' }, '🔧'),
               ' DIYMatch'
             ),
             React.createElement('div', { className: 'flex items-center gap-4' },
               React.createElement('div', { className: 'relative' },
                 React.createElement('button', { className: 'text-2xl' }, '🔔'),
                 notifications.filter(n => !n.read).length > 0 &&
                 React.createElement('span', { className: 'notification-badge' },
                   notifications.filter(n => !n.read).length
                 )
               ),
               React.createElement('button', {
                 onClick: onLogout,
                 className: 'text-gray-600 hover:text-gray-800'
               }, 'Logout')
             )
           )
         )
       ),
       
       React.createElement('div', { className: 'container mx-auto px-4 py-6 pb-20' },
         activeTab === 'home' && renderHomeTab(),
         activeTab === 'analyze' && renderAnalyzeTab(),
         activeTab === 'experts' && renderExpertsTab(),
         activeTab === 'emergency' && renderEmergencyTab(),
         activeTab === 'parts' && renderPartsTab(),
         activeTab === 'history' && renderHistoryTab(),
         activeTab === 'profile' && renderProfileTab()
       ),
       
       React.createElement('div', { className: 'bottom-nav safe-area-bottom' },
         React.createElement('button', {
           onClick: () => setActiveTab('home'),
           className: `bottom-nav-item ${activeTab === 'home' ? 'active' : ''}`
         },
           React.createElement('div', { className: 'bottom-nav-icon' }, '🏠'),
           React.createElement('span', null, 'Home')
         ),
         React.createElement('button', {
           onClick: () => setActiveTab('analyze'),
           className: `bottom-nav-item ${activeTab === 'analyze' ? 'active' : ''}`
         },
           React.createElement('div', { className: 'bottom-nav-icon' }, '📸'),
           React.createElement('span', null, 'Analyze')
         ),
         React.createElement('button', {
           onClick: () => setActiveTab('experts'),
           className: `bottom-nav-item ${activeTab === 'experts' ? 'active' : ''}`
         },
           React.createElement('div', { className: 'bottom-nav-icon' }, '👨‍🔧'),
           React.createElement('span', null, 'Experts')
         ),
         React.createElement('button', {
           onClick: () => setActiveTab('history'),
           className: `bottom-nav-item ${activeTab === 'history' ? 'active' : ''}`
         },
           React.createElement('div', { className: 'bottom-nav-icon' }, '📋'),
           React.createElement('span', null, 'History')
         ),
         React.createElement('button', {
           onClick: () => setActiveTab('profile'),
           className: `bottom-nav-item ${activeTab === 'profile' ? 'active' : ''}`
         },
           React.createElement('div', { className: 'bottom-nav-icon' }, '👤'),
           React.createElement('span', null, 'Profile')
         )
       )
     );
   };

   // AI Analysis Page Component
   const AIAnalysisPage = ({ user }) => {
     const [step, setStep] = useState(1);
     const [media, setMedia] = useState(null);
     const [description, setDescription] = useState('');
     const [analyzing, setAnalyzing] = useState(false);
     const [progress, setProgress] = useState(0);
     const [progressMessage, setProgressMessage] = useState('');
     const [analysis, setAnalysis] = useState(null);
     
     const handleMediaCapture = async (type) => {
       try {
         let capturedMedia;
         if (type === 'photo') {
           capturedMedia = await takePhoto();
         } else if (type === 'video') {
           capturedMedia = await takeVideo();
         } else if (type === 'voice') {
           capturedMedia = await recordVoiceNote();
         }
         
         if (capturedMedia) {
           setMedia(capturedMedia);
           setStep(2);
           triggerHaptic('success');
         }
       } catch (error) {
         console.error('Media capture error:', error);
         alert('Failed to capture media. Please try again.');
       }
     };
     
     const handleAnalysis = async () => {
       if (!media || !description.trim()) {
         alert('Please provide both media and description');
         return;
       }
       
       setAnalyzing(true);
       setStep(3);
       
       try {
         const analysisResult = await performAIAnalysis(
           media,
           description,
           (prog, msg) => {
             setProgress(prog);
             setProgressMessage(msg);
           }
         );
         
         const isFree = checkFreeAnalysisAvailable(user.email);
         
         if (!isFree) {
           const paymentResult = await paymentService.processPayment(
             APP_CONFIG.aiAnalysisPrice,
             { type: 'ai_analysis', userId: user.id }
           );
           
           if (!paymentResult.success) {
             throw new Error('Payment failed');
           }
         } else {
           useFreeAnalysis(user.email);
         }
         
         const savedAnalysis = {
           ...analysisResult,
           userEmail: user.email,
           media: media,
           description: description
         };
         
         await dbOperations.saveAnalysis(savedAnalysis);
         
         setAnalysis(analysisResult);
         setStep(4);
         triggerHaptic('success');
       } catch (error) {
         console.error('Analysis error:', error);
         alert('Analysis failed. Please try again.');
         setStep(2);
       } finally {
         setAnalyzing(false);
       }
     };
     
     const renderStep1 = () => React.createElement('div', { className: 'space-y-6' },
       React.createElement('h2', { className: 'text-2xl font-bold text-center' }, 'Capture Your Problem'),
       React.createElement('p', { className: 'text-center text-gray-600' }, 
         'Choose how you\'d like to show us the issue'
       ),
       
       React.createElement('div', { className: 'grid grid-cols-1 gap-4' },
         React.createElement('button', {
           onClick: () => handleMediaCapture('photo'),
           className: 'mobile-touch bg-blue-600 text-white p-6 rounded-xl hover:bg-blue-700 transition-all flex items-center justify-between'
         },
           React.createElement('div', { className: 'flex items-center' },
             React.createElement('div', { className: 'text-3xl mr-4' }, '📸'),
             React.createElement('div', { className: 'text-left' },
               React.createElement('div', { className: 'font-semibold' }, 'Take Photo'),
               React.createElement('div', { className: 'text-sm opacity-80' }, 'Best for most issues')
             )
           ),
           React.createElement('div', { className: 'text-2xl' }, '→')
         ),
         
         React.createElement('button', {
           onClick: () => handleMediaCapture('video'),
           className: 'mobile-touch bg-purple-600 text-white p-6 rounded-xl hover:bg-purple-700 transition-all flex items-center justify-between'
         },
           React.createElement('div', { className: 'flex items-center' },
             React.createElement('div', { className: 'text-3xl mr-4' }, '🎥'),
             React.createElement('div', { className: 'text-left' },
               React.createElement('div', { className: 'font-semibold' }, 'Record Video'),
               React.createElement('div', { className: 'text-sm opacity-80' }, 'For complex issues')
             )
           ),
           React.createElement('div', { className: 'text-2xl' }, '→')
         ),
         
         React.createElement('button', {
           onClick: () => handleMediaCapture('voice'),
           className: 'mobile-touch bg-green-600 text-white p-6 rounded-xl hover:bg-green-700 transition-all flex items-center justify-between'
         },
           React.createElement('div', { className: 'flex items-center' },
             React.createElement('div', { className: 'text-3xl mr-4' }, '🎤'),
             React.createElement('div', { className: 'text-left' },
               React.createElement('div', { className: 'font-semibold' }, 'Voice Note'),
               React.createElement('div', { className: 'text-sm opacity-80' }, 'Describe verbally')
             )
           ),
           React.createElement('div', { className: 'text-2xl' }, '→')
         )
       )
     );
     
     const renderStep2 = () => React.createElement('div', { className: 'space-y-6' },
       React.createElement('h2', { className: 'text-2xl font-bold text-center' }, 'Describe the Problem'),
       
       media && React.createElement('div', { className: 'bg-gray-100 rounded-lg p-4' },
         media.type === 'image' && React.createElement('img', {
           src: media.data,
           alt: 'Problem',
           className: 'w-full rounded-lg'
         }),
         media.type === 'video' && React.createElement('video', {
           src: media.data,
           controls: true,
           className: 'w-full rounded-lg'
         }),
         media.type === 'voice' && React.createElement('div', { className: 'text-center py-8' },
           React.createElement('div', { className: 'text-4xl mb-2' }, '🎤'),
           React.createElement('p', null, `Voice note recorded (${media.duration}s)`)
         )
       ),
       
       React.createElement('div', null,
         React.createElement('label', { className: 'block text-sm font-medium mb-2' },
           'Tell us more about the problem:'
         ),
         React.createElement('textarea', {
           value: description,
           onChange: (e) => setDescription(e.target.value),
           className: 'w-full p-3 border rounded-lg resize-none',
           rows: 4,
           placeholder: 'E.g., Leaking pipe under kitchen sink, started yesterday...'
         })
       ),
       
       React.createElement('div', { className: 'bg-yellow-50 p-4 rounded-lg' },
         React.createElement('p', { className: 'text-sm' },
           React.createElement('strong', null, 'Tip: '),
           'Include details like when it started, any unusual sounds/smells, and what you\'ve already tried.'
         )
       ),
       
       React.createElement('div', { className: 'flex gap-4' },
         React.createElement('button', {
           onClick: () => setStep(1),
           className: 'flex-1 bg-gray-200 text-gray-800 py-3 rounded-lg font-semibold'
         }, '← Back'),
         React.createElement('button', {
           onClick: handleAnalysis,
           disabled: !description.trim(),
           className: `flex-1 py-3 rounded-lg font-semibold ${
             description.trim()
               ? 'bg-blue-600 text-white hover:bg-blue-700'
               : 'bg-gray-300 text-gray-500 cursor-not-allowed'
           }`
         }, 'Analyze →')
       )
     );
     
     const renderStep3 = () => React.createElement('div', { className: 'space-y-6 text-center' },
       React.createElement('h2', { className: 'text-2xl font-bold' }, 'AI Analysis in Progress'),
       
       React.createElement('div', { className: 'relative w-32 h-32 mx-auto' },
         React.createElement('div', {
           className: 'absolute inset-0 bg-blue-200 rounded-full animate-ping'
         }),
         React.createElement('div', {
           className: 'relative bg-blue-600 rounded-full w-32 h-32 flex items-center justify-center text-white text-5xl'
         }, '🤖')
       ),
       
       React.createElement('div', { className: 'space-y-2' },
         React.createElement('div', { className: 'text-lg font-medium' }, progressMessage),
         React.createElement('div', { className: 'w-full bg-gray-200 rounded-full h-3 overflow-hidden' },
           React.createElement('div', {
             className: 'analysis-progress h-full transition-all duration-300',
             style: { width: `${progress}%` }
           })
         ),
         React.createElement('div', { className: 'text-sm text-gray-600' }, `${progress}% Complete`)
       ),
       
       React.createElement('p', { className: 'text-gray-600' },
         'Our AI is analyzing your problem using advanced pattern recognition...'
       )
     );
     
     const renderStep4 = () => React.createElement('div', { className: 'space-y-6' },
       React.createElement('h2', { className: 'text-2xl font-bold text-center' }, 'Analysis Complete!'),
       
       analysis && React.createElement('div', { className: 'bg-white rounded-lg shadow-lg p-6 space-y-4' },
         React.createElement('div', { className: 'flex justify-between items-start' },
           React.createElement('div', null,
             React.createElement('h3', { className: 'text-xl font-semibold' }, analysis.problemDetected),
             React.createElement('p', { className: 'text-gray-600' }, `Confidence: ${analysis.confidence}`)
           ),
           React.createElement('div', {
             className: `px-3 py-1 rounded-full text-sm ${
               analysis.severity === 'Critical' ? 'bg-red-100 text-red-800' :
               analysis.severity === 'High' ? 'bg-orange-100 text-orange-800' :
               'bg-yellow-100 text-yellow-800'
             }`
           }, `${analysis.severity} Severity`)
         ),
         
         React.createElement('p', { className: 'text-gray-700' }, analysis.description),
         
         React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
           React.createElement('div', { className: 'bg-gray-50 p-3 rounded-lg' },
             React.createElement('div', { className: 'text-sm text-gray-600' }, 'Estimated Cost'),
             React.createElement('div', { className: 'font-semibold' }, analysis.estimatedCost)
           ),
           React.createElement('div', { className: 'bg-gray-50 p-3 rounded-lg' },
             React.createElement('div', { className: 'text-sm text-gray-600' }, 'Time to Fix'),
             React.createElement('div', { className: 'font-semibold' }, analysis.timeToFix)
           )
         ),
         
         analysis.safetyWarnings && analysis.safetyWarnings.length > 0 &&
         React.createElement('div', { className: 'bg-red-50 p-4 rounded-lg' },
           React.createElement('h4', { className: 'font-semibold text-red-800 mb-2' }, '⚠️ Safety Warnings'),
           React.createElement('ul', { className: 'space-y-1' },
             analysis.safetyWarnings.map((warning, index) =>
               React.createElement('li', { key: index, className: 'text-sm text-red-700' }, warning)
             )
           )
         ),
         
         analysis.isDIYFriendly
           ? React.createElement('div', { className: 'bg-green-50 p-4 rounded-lg' },
               React.createElement('h4', { className: 'font-semibold text-green-800 mb-2' }, '✅ DIY Friendly!'),
               React.createElement('p', { className: 'text-sm text-green-700' },
                 'This issue can be safely handled as a DIY project with proper precautions.'
               )
             )
           : React.createElement('div', { className: 'bg-orange-50 p-4 rounded-lg' },
               React.createElement('h4', { className: 'font-semibold text-orange-800 mb-2' }, '👨‍🔧 Professional Required'),
               React.createElement('p', { className: 'text-sm text-orange-700' },
                 `This issue requires professional expertise. We recommend hiring a ${analysis.recommendedExpertType}.`
               )
             ),
         
         React.createElement('div', { className: 'flex flex-col gap-3' },
           analysis.isDIYFriendly && React.createElement('button', {
             onClick: () => alert('DIY Guide coming soon!'),
             className: 'w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700'
           }, 'View DIY Guide →'),
           
           React.createElement('button', {
             onClick: () => alert('Expert search coming soon!'),
             className: 'w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700'
           }, `Find ${analysis.recommendedExpertType} →`),
           
           React.createElement('button', {
             onClick: () => alert('Parts finder coming soon!'),
             className: 'w-full bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700'
           }, 'Find Parts & Tools →')
         )
       ),
       
       React.createElement('button', {
         onClick: () => {
           setStep(1);
           setMedia(null);
           setDescription('');
           setAnalysis(null);
         },
         className: 'w-full bg-gray-200 text-gray-800 py-3 rounded-lg font-semibold'
       }, 'Start New Analysis')
     );
     
     return React.createElement('div', { className: 'max-w-2xl mx-auto' },
       React.createElement(ProgressSteps, {
         steps: ['Capture', 'Describe', 'Analyze', 'Results'],
         currentStep: step - 1
       }),
       
       step === 1 && renderStep1(),
       step === 2 && renderStep2(),
       step === 3 && renderStep3(),
       step === 4 && renderStep4()
     );
   };

   // Other page components (simplified for brevity)
   const ExpertSearchPage = ({ user }) => {
     const [experts] = useState(Array.from(expertProfiles.values()));
     
     return React.createElement('div', { className: 'space-y-6' },
       React.createElement('h2', { className: 'text-2xl font-bold' }, 'Find Expert Help'),
       
       React.createElement('div', { className: 'space-y-4' },
         experts.map(expert =>
           React.createElement('div', {
             key: expert.id,
             className: 'bg-white rounded-lg shadow-md p-6'
           },
             React.createElement('div', { className: 'flex justify-between items-start mb-4' },
               React.createElement('div', null,
                 React.createElement('h3', { className: 'text-lg font-semibold' }, expert.name),
                 React.createElement('p', { className: 'text-gray-600' }, expert.profession),
                 React.createElement('p', { className: 'text-sm text-gray-500' }, expert.location)
               ),
               React.createElement('div', { className: 'text-right' },
                 React.createElement(StarRating, { rating: parseFloat(expert.rating), readonly: true }),
                 React.createElement('p', { className: 'text-sm text-gray-600' }, `(${expert.reviews} reviews)`)
               )
             ),
             React.createElement('p', { className: 'text-gray-700 mb-4' }, expert.bio),
             React.createElement('div', { className: 'flex gap-2' },
               React.createElement('button', {
                 onClick: () => alert('Contact feature coming soon!'),
                 className: 'flex-1 bg-blue-600 text-white py-2 rounded-lg font-semibold'
               }, 'Contact Expert'),
               React.createElement('button', {
                 onClick: () => alert('Profile view coming soon!'),
                 className: 'flex-1 bg-gray-200 text-gray-800 py-2 rounded-lg font-semibold'
               }, 'View Profile')
             )
           )
         )
       )
     );
   };

   const EmergencyHelpPage = ({ user }) => {
     return React.createElement('div', { className: 'space-y-6' },
       React.createElement('div', { className: 'bg-red-600 text-white rounded-lg p-6 text-center' },
         React.createElement('h2', { className: 'text-2xl font-bold mb-2' }, '🚨 Emergency Help'),
         React.createElement('p', null, 'For life-threatening emergencies, call 999 immediately'),
         React.createElement('a', {
           href: 'tel:999',
           className: 'inline-block mt-4 bg-white text-red-600 px-6 py-3 rounded-lg font-semibold'
         }, '📞 Call 999')
       ),
       
       React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6' },
         React.createElement('h3', { className: 'text-xl font-semibold mb-4' }, 'Emergency Contacts'),
         React.createElement('ul', { className: 'space-y-2' },
           React.createElement('li', null, '🔥 Gas Emergency: ', 
             React.createElement('a', { href: 'tel:0800111999', className: 'text-blue-600' }, '0800 111 999')
           ),
           React.createElement('li', null, '💡 Power Cut: ', 
             React.createElement('a', { href: 'tel:105', className: 'text-blue-600' }, '105')
           ),
           React.createElement('li', null, '💧 Water Emergency: Check your supplier')
         )
       )
     );
   };

   const PartsFinderPage = ({ user }) => {
     const [stores] = useState(partsStores.get('london') || []);
     
     return React.createElement('div', { className: 'space-y-6' },
       React.createElement('h2', { className: 'text-2xl font-bold' }, 'Find Parts & Tools'),
       
       React.createElement('div', { className: 'space-y-4' },
         stores.map(store =>
           React.createElement('div', {
             key: store.id,
             className: 'bg-white rounded-lg shadow-md p-4'
           },
             React.createElement('h4', { className: 'font-semibold' }, store.name),
             React.createElement('p', { className: 'text-sm text-gray-600' }, store.address),
             React.createElement('p', { className: 'text-sm text-blue-600' }, store.distance),
             React.createElement('div', { className: 'flex gap-2 mt-3' },
               React.createElement('button', {
                 onClick: () => window.location.href = `tel:${store.phone}`,
                 className: 'flex-1 bg-green-600 text-white py-2 rounded-lg text-sm font-semibold'
               }, '📞 Call'),
               React.createElement('button', {
                 onClick: () => window.open(`https://maps.google.com/?q=${encodeURIComponent(store.address)}`),
                 className: 'flex-1 bg-blue-600 text-white py-2 rounded-lg text-sm font-semibold'
               }, '📍 Directions')
             )
           )
         )
       )
     );
   };

   const UserProfilePage = ({ user }) => {
     return React.createElement('div', { className: 'space-y-6' },
       React.createElement('h2', { className: 'text-2xl font-bold' }, 'My Profile'),
       
       React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6' },
         React.createElement('h3', { className: 'text-lg font-semibold mb-4' }, 'Personal Information'),
         React.createElement('div', { className: 'space-y-4' },
           React.createElement('div', null,
             React.createElement('label', { className: 'block text-sm text-gray-600 mb-1' }, 'Name'),
             React.createElement('p', { className: 'font-medium' }, user.name)
           ),
           React.createElement('div', null,
             React.createElement('label', { className: 'block text-sm text-gray-600 mb-1' }, 'Email'),
             React.createElement('p', { className: 'font-medium' }, user.email)
           ),
           React.createElement('div', null,
             React.createElement('label', { className: 'block text-sm text-gray-600 mb-1' }, 'Referral Code'),
             React.createElement('p', { className: 'font-medium' }, user.referralCode)
           )
         )
       )
     );
   };

   // Expert Dashboard
   const ExpertDashboard = ({ expert, onLogout }) => {
     return React.createElement('div', { className: 'min-h-screen bg-gray-50' },
       React.createElement('div', { className: 'safe-area-top bg-white shadow-sm' },
         React.createElement('div', { className: 'container mx-auto px-4 py-4' },
           React.createElement('div', { className: 'flex justify-between items-center' },
             React.createElement('h1', { className: 'text-2xl font-bold flex items-center' },
               React.createElement('span', { className: 'text-3xl mr-2' }, '👨‍🔧'),
               ' Expert Portal'
             ),
             React.createElement('button', {
               onClick: onLogout,
               className: 'text-gray-600 hover:text-gray-800'
             }, 'Logout')
           )
         )
       ),
       
       React.createElement('div', { className: 'container mx-auto px-4 py-6' },
         React.createElement('div', { className: 'bg-gradient-to-r from-green-500 to-blue-600 rounded-xl p-6 text-white mb-6' },
           React.createElement('h2', { className: 'text-2xl font-bold mb-2' }, `Welcome back, ${expert.name}!`),
           React.createElement('p', null, `${expert.profession} • ${expert.location}`),
           React.createElement('div', { className: 'mt-4' },
             React.createElement('div', { className: 'text-3xl font-bold' }, `${expert.rating} ⭐`),
             React.createElement('div', { className: 'text-sm opacity-80' }, `${expert.reviews} reviews`)
           )
         ),
         
         React.createElement('div', { className: 'text-center py-12' },
           React.createElement('p', { className: 'text-gray-600' }, 'Expert dashboard features coming soon!')
         )
       )
     );
   };

   // Admin Dashboard
   const AdminDashboard = ({ onLogout }) => {
     const stats = {
       totalUsers: registeredUsers.size,
       totalExperts: expertProfiles.size,
       totalAnalyses: Array.from(aiAnalysisHistory.values()).flat().length,
       totalBookings: 0
     };
     
     return React.createElement('div', { className: 'min-h-screen bg-gray-100' },
       React.createElement('div', { className: 'bg-white shadow-sm' },
         React.createElement('div', { className: 'container mx-auto px-4 py-4' },
           React.createElement('div', { className: 'flex justify-between items-center' },
             React.createElement('h1', { className: 'text-2xl font-bold' }, 'Admin Dashboard'),
             React.createElement('button', {
               onClick: onLogout,
               className: 'text-gray-600'
             }, 'Logout')
           )
         )
       ),
       
       React.createElement('div', { className: 'container mx-auto px-4 py-6' },
         React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-4 gap-4 mb-6' },
           React.createElement('div', { className: 'admin-stat-card' },
             React.createElement('div', { className: 'admin-stat-value' }, stats.totalUsers),
             React.createElement('div', { className: 'admin-stat-label' }, 'Total Users')
           ),
           React.createElement('div', { className: 'admin-stat-card' },
             React.createElement('div', { className: 'admin-stat-value' }, stats.totalExperts),
             React.createElement('div', { className: 'admin-stat-label' }, 'Total Experts')
           ),
           React.createElement('div', { className: 'admin-stat-card' },
             React.createElement('div', { className: 'admin-stat-value' }, stats.totalAnalyses),
             React.createElement('div', { className: 'admin-stat-label' }, 'Total Analyses')
           ),
           React.createElement('div', { className: 'admin-stat-card' },
             React.createElement('div', { className: 'admin-stat-value' }, stats.totalBookings),
             React.createElement('div', { className: 'admin-stat-label' }, 'Total Bookings')
           )
         ),
         
         React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6' },
           React.createElement('h2', { className: 'text-xl font-semibold mb-4' }, 'System Status'),
           React.createElement('p', { className: 'text-green-600' }, '✓ All systems operational')
         )
       )
     );
   };

   // Authentication Pages
   const LoginPage = ({ onLogin, onSignup, onBack, userType = 'user' }) => {
     const [email, setEmail] = useState('');
     const [password, setPassword] = useState('');
     const [loading, setLoading] = useState(false);
     
     const handleLogin = async (e) => {
       e.preventDefault();
       setLoading(true);
       
       try {
         if (userType === 'admin' && email === APP_CONFIG.adminEmail && password === APP_CONFIG.adminPassword) {
           analytics.track('admin_login', { email });
           onLogin({ type: 'admin', email });
           return;
         }
         
         const user = registeredUsers.get(email.toLowerCase());
         if (user && user.password === password) {
           analytics.track('user_login', { userType, email });
           onLogin({ ...user, type: userType });
           return;
         }
         
         alert('Invalid email or password');
       } catch (error) {
         console.error('Login error:', error);
         alert('Login failed. Please try again.');
       } finally {
         setLoading(false);
       }
     };
     
     return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center p-4' },
       React.createElement('div', { className: 'bg-white rounded-2xl shadow-xl p-8 w-full max-w-md' },
         React.createElement('div', { className: 'text-center mb-8' },
           React.createElement('div', { className: 'text-5xl mb-4' },
             userType === 'expert' ? '👨‍🔧' : userType === 'admin' ? '⚙️' : '🔧'
           ),
           React.createElement('h2', { className: 'text-3xl font-bold mb-2' },
             userType === 'expert' ? 'Expert Login' : userType === 'admin' ? 'Admin Login' : 'Welcome Back'
           ),
           React.createElement('p', { className: 'text-gray-600' }, 'Sign in to your account')
         ),
         
         React.createElement('form', { onSubmit: handleLogin, className: 'space-y-4' },
           React.createElement('div', null,
             React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Email'),
             React.createElement('input', {
               type: 'email',
               value: email,
               onChange: (e) => setEmail(e.target.value),
               className: 'w-full p-3 border rounded-lg',
               placeholder: 'your@email.com',
               required: true
             })
           ),
           
           React.createElement('div', null,
             React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Password'),
             React.createElement('input', {
               type: 'password',
               value: password,
               onChange: (e) => setPassword(e.target.value),
               className: 'w-full p-3 border rounded-lg',
               placeholder: '••••••••',
               required: true
             })
           ),
           
           React.createElement('button', {
             type: 'submit',
             disabled: loading,
             className: `w-full py-3 rounded-lg font-semibold transition-all ${
               loading
                 ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                 : 'bg-blue-600 text-white hover:bg-blue-700'
             }`
           }, loading ? 'Signing in...' : 'Sign In')
         ),
         
         userType === 'user' && React.createElement('div', { className: 'mt-6 text-center' },
           React.createElement('p', { className: 'text-gray-600' },
             "Don't have an account? ",
             React.createElement('button', {
               onClick: onSignup,
               className: 'text-blue-600 hover:text-blue-800 font-semibold'
             }, 'Sign up')
           )
         ),
         
         React.createElement('div', { className: 'mt-6 text-center' },
           React.createElement('button', {
             onClick: onBack,
             className: 'text-gray-600 hover:text-gray-800'
           }, '← Back')
         ),
         
         // Demo login info
         userType === 'user' && React.createElement('div', { className: 'mt-4 p-3 bg-blue-50 rounded-lg text-sm' },
           React.createElement('p', { className: 'font-semibold' }, 'Demo Login:'),
           React.createElement('p', null, 'Email: demo@example.com'),
           React.createElement('p', null, 'Password: demo123')
         ),
         
         userType === 'expert' && React.createElement('div', { className: 'mt-4 p-3 bg-green-50 rounded-lg text-sm' },
           React.createElement('p', { className: 'font-semibold' }, 'Demo Expert Login:'),
           React.createElement('p', null, 'Email: john@example.com'),
           React.createElement('p', null, 'Password: password123')
         )
       )
     );
   };

   const SignupPage = ({ onSignup, onBack, userType = 'user' }) => {
     const [formData, setFormData] = useState({
       name: '',
       email: '',
       password: '',
       confirmPassword: '',
       acceptTerms: false
     });
     const [loading, setLoading] = useState(false);
     
     const handleSubmit = async (e) => {
       e.preventDefault();
       
       if (formData.password !== formData.confirmPassword) {
         alert('Passwords do not match');
         return;
       }
       
       if (!formData.acceptTerms) {
         alert('Please accept the terms and conditions');
         return;
       }
       
       setLoading(true);
       
       try {
         if (registeredUsers.has(formData.email.toLowerCase())) {
           alert('An account with this email already exists');
           return;
         }
         
         const userData = {
           name: formData.name,
           email: formData.email.toLowerCase(),
           password: formData.password,
           userType: 'user'
         };
         
         const result = await dbOperations.createUser(userData);
         
         if (result.success) {
           alert('Account created successfully!');
           onSignup({ ...result.user, type: 'user' });
         }
       } catch (error) {
         console.error('Signup error:', error);
         alert('Signup failed. Please try again.');
       } finally {
         setLoading(false);
       }
     };
     
     return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center p-4' },
       React.createElement('div', { className: 'bg-white rounded-2xl shadow-xl p-8 w-full max-w-md' },
         React.createElement('div', { className: 'text-center mb-8' },
           React.createElement('div', { className: 'text-5xl mb-4' }, '🔧'),
           React.createElement('h2', { className: 'text-3xl font-bold mb-2' }, 'Create Account'),
           React.createElement('p', { className: 'text-gray-600' }, 'Get started with DIYMatch')
         ),
         
         React.createElement('form', { onSubmit: handleSubmit, className: 'space-y-4' },
           React.createElement('div', null,
             React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Full Name'),
             React.createElement('input', {
               type: 'text',
               value: formData.name,
               onChange: (e) => setFormData({...formData, name: e.target.value}),
               className: 'w-full p-3 border rounded-lg',
               required: true
             })
           ),
           
           React.createElement('div', null,
             React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Email'),
             React.createElement('input', {
               type: 'email',
               value: formData.email,
               onChange: (e) => setFormData({...formData, email: e.target.value}),
               className: 'w-full p-3 border rounded-lg',
               required: true
             })
           ),
           
           React.createElement('div', null,
             React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Password'),
             React.createElement('input', {
               type: 'password',
               value: formData.password,
               onChange: (e) => setFormData({...formData, password: e.target.value}),
               className: 'w-full p-3 border rounded-lg',
               minLength: 6,
               required: true
             })
           ),
           
           React.createElement('div', null,
             React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Confirm Password'),
             React.createElement('input', {
               type: 'password',
               value: formData.confirmPassword,
               onChange: (e) => setFormData({...formData, confirmPassword: e.target.value}),
               className: 'w-full p-3 border rounded-lg',
               required: true
             })
           ),
           
           React.createElement('div', { className: 'bg-gray-50 p-4 rounded-lg' },
             React.createElement('label', { className: 'flex items-start' },
               React.createElement('input', {
                 type: 'checkbox',
                 checked: formData.acceptTerms,
                 onChange: (e) => setFormData({...formData, acceptTerms: e.target.checked}),
                 className: 'mt-1 mr-2'
               }),
               React.createElement('span', { className: 'text-sm text-gray-700' },
                 'I accept the Terms of Service and Privacy Policy'
               )
             )
           ),
           
           React.createElement('button', {
             type: 'submit',
             disabled: loading || !formData.acceptTerms,
             className: `w-full py-3 rounded-lg font-semibold transition-all ${
               loading || !formData.acceptTerms
                 ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                 : 'bg-blue-600 text-white hover:bg-blue-700'
             }`
           }, loading ? 'Creating Account...' : 'Create Account')
         ),
         
         React.createElement('div', { className: 'mt-6 text-center' },
           React.createElement('button', {
             onClick: onBack,
             className: 'text-gray-600 hover:text-gray-800'
           }, '← Back to Login')
         )
       )
     );
   };

   // Main App Component
   const App = () => {
     const [currentView, setCurrentView] = useState('welcome');
     const [currentUser, setCurrentUser] = useState(null);
     const [isLoading, setIsLoading] = useState(true);
     
     useEffect(() => {
       // Hide splash screen
       setTimeout(() => {
         const splash = document.getElementById('splash-screen');
         if (splash) {
           splash.style.opacity = '0';
           setTimeout(() => splash.remove(), 300);
         }
         setIsLoading(false);
       }, 2000);
     }, []);
     
     const handleLogin = (user) => {
       setCurrentUser(user);
       
       switch (user.type) {
         case 'admin':
           setCurrentView('admin_dashboard');
           break;
         case 'expert':
           setCurrentView('expert_dashboard');
           break;
         default:
           setCurrentView('user_dashboard');
       }
     };
     
     const handleLogout = () => {
       setCurrentUser(null);
       setCurrentView('welcome');
       analytics.track('logout', { userType: currentUser?.type });
     };
     
     if (isLoading) {
       return null;
     }
     
     return React.createElement(ErrorBoundary, null,
       React.createElement(NotificationContext.Provider, { value: useNotifications() },
         React.createElement(AuthContext.Provider, { 
           value: { user: currentUser, login: handleLogin, logout: handleLogout }
         },
           currentView === 'welcome' && React.createElement(WelcomePage, {
             onGetStarted: () => setCurrentView('user_login'),
             onLoginExpert: () => setCurrentView('expert_login')
           }),
           
           currentView === 'user_login' && React.createElement(LoginPage, {
             userType: 'user',
             onLogin: handleLogin,
             onSignup: () => setCurrentView('user_signup'),
             onBack: () => setCurrentView('welcome')
           }),
           
           currentView === 'user_signup' && React.createElement(SignupPage, {
             userType: 'user',
             onSignup: handleLogin,
             onBack: () => setCurrentView('user_login')
           }),
           
           currentView === 'expert_login' && React.createElement(LoginPage, {
             userType: 'expert',
             onLogin: handleLogin,
             onSignup: () => setCurrentView('expert_signup'),
             onBack: () => setCurrentView('welcome')
           }),
           
           currentView === 'expert_signup' && React.createElement(SignupPage, {
             userType: 'expert',
             onSignup: handleLogin,
             onBack: () => setCurrentView('expert_login')
           }),
           
           currentView === 'user_dashboard' && currentUser && 
             React.createElement(UserDashboard, { user: currentUser, onLogout: handleLogout }),
           
           currentView === 'expert_dashboard' && currentUser && 
             React.createElement(ExpertDashboard, { expert: currentUser, onLogout: handleLogout }),
           
           currentView === 'admin_dashboard' && currentUser && 
             React.createElement(AdminDashboard, { onLogout: handleLogout }),
           
           currentView === 'admin_login' && React.createElement(LoginPage, {
             userType: 'admin',
             onLogin: handleLogin,
             onBack: () => setCurrentView('welcome')
           })
         )
       )
     );
   };

   // ============================================================================
   // APP INITIALIZATION
   // ============================================================================
   
   // Add admin login shortcut (triple-click on logo)
   let clickCount = 0;
   let clickTimer = null;
   
   document.addEventListener('click', (e) => {
     if (e.target.textContent === '🔧' || e.target.textContent === 'DIYMatch') {
       clickCount++;
       
       if (clickTimer) clearTimeout(clickTimer);
       
       clickTimer = setTimeout(() => {
         if (clickCount >= 3) {
           // Force navigate to admin login
           const root = ReactDOM.createRoot(document.getElementById('root'));
           root.render(React.createElement(App));
           setTimeout(() => {
             const event = new Event('adminLogin');
             window.dispatchEvent(event);
           }, 100);
         }
         clickCount = 0;
       }, 500);
     }
   });
   
   // Render the app
   const root = ReactDOM.createRoot(document.getElementById('root'));
   root.render(React.createElement(App));
 </script>
</body>
</html>
